<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHD Status Dashboard</title>
    <style>
        :root { --shd-orange: #ff6600; --shd-green: #00ff88; --bg: #0a0a0b; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; text-transform: uppercase; letter-spacing: 1px; }
        .card { border-left: 4px solid var(--shd-orange); background: #15171a; padding: 25px; width: 90%; max-width: 500px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .status-light { width: 12px; height: 12px; border-radius: 50%; display: inline-block; margin-right: 10px; }
        .online { background: var(--shd-green); box-shadow: 0 0 10px var(--shd-green); }
        .maint { background: var(--shd-orange); animation: pulse 1.5s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
        .timer { font-size: 2.8rem; font-weight: bold; margin: 15px 0; font-family: monospace; color: #fff; }
        .info { color: #888; font-size: 0.75rem; margin-bottom: 5px; }
        a { color: var(--shd-orange); text-decoration: none; border: 1px solid var(--shd-orange); padding: 6px 12px; font-size: 0.7rem; display: inline-block; margin-top: 10px; }
        a:hover { background: var(--shd-orange); color: black; }
    </style>
</head>
<body>
    <div class="card">
        <div style="margin-bottom: 15px;">
            <span id="light" class="status-light"></span>
            <span id="status-text" style="font-size: 0.9rem;">Connecting...</span>
        </div>
        <div id="title" style="color: var(--shd-orange); font-weight: bold; margin-bottom: 20px; font-size: 0.9rem;">Initializing...</div>
        <div class="timer" id="countdown">00:00:00</div>
        <div class="info" id="local-start"></div>
        <div class="info" id="local-end" style="margin-bottom: 10px;"></div>
        <div id="link-container"></div>
    </div>

    <script>
        const userTZ = Intl.DateTimeFormat().resolvedOptions().timeZone;
        
        async function update() {
            const r = await fetch('./status.json?t=' + Date.now());
            const data = await r.json();
            const now = new Date();
            const start = new Date(data.utc_start);
            const end = new Date(data.utc_end);
            
            document.getElementById('title').innerText = data.title;
            const isValid = !isNaN(start.getTime()) && !isNaN(end.getTime());

            if (!data.utc_start || !isValid || now > end) {
                document.getElementById('light').className = "status-light online";
                document.getElementById('status-text').innerText = "Systems Online";
                document.getElementById('countdown').innerText = "00:00:00";
            } else {
                const isOngoing = now >= start;
                const target = isOngoing ? end : start;
                document.getElementById('status-text').innerText = isOngoing ? "Maint In Progress" : "Maint Scheduled";
                document.getElementById('light').className = isOngoing ? "status-light maint" : "status-light";
                if(!isOngoing) document.getElementById('light').style.background = "#555";

                const timerFunc = () => {
                    const diff = target - new Date();
                    if (diff <= 0) return location.reload();
                    const h = Math.floor(diff/3600000), m = Math.floor((diff%3600000)/60000), s = Math.floor((diff%60000)/1000);
                    document.getElementById('countdown').innerText = 
                        `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
                };
                timerFunc();
                setInterval(timerFunc, 1000);
            }

            if (isValid) {
                const fmt = { timeZone: userTZ, hour: '2-digit', minute: '2-digit', day: 'numeric', month: 'short', timeZoneName: 'short' };
                document.getElementById('local-start').innerText = `Start: ${start.toLocaleString(undefined, fmt)}`;
                document.getElementById('local-end').innerText = `Expected End: ${end.toLocaleString(undefined, fmt)}`;
                document.getElementById('link-container').innerHTML = `<a href="${data.url}" target="_blank">View Intel Source</a>`;
            }
        }
        update();
    </script>
</body>
</html>
